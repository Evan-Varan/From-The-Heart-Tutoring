<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8C6EXQKJ0S"></script>
<script src="../Javascript/analytics.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recommended Tutors | From the Heart Tutoring</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../Navbar/Navbar.css"> <!-- Link to navbar CSS -->
    <link rel="stylesheet" href="../Progress/Progress.css">
    <link rel="stylesheet" href="../CSS/Button.css"> <!-- Added Button CSS -->
    
    <style>
    body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        background-color: #f9f9f9;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
        min-height: 100vh; /* Ensure body takes at least full viewport height */
    }

    html {
        height: 100%;
    }

    /* Fixed background pattern styling */
    .background-pattern {
        position: fixed; /* Changed from absolute to fixed */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background-image: url('https://www.toptal.com/designers/subtlepatterns/uploads/fishnets-and-hearts.png');
        background-repeat: repeat;
        opacity: 0.9; /* Default opacity */
        pointer-events: none;
    }

    /* Add a min-height to ensure content area stretches */
    #main-content {
        min-height: 100vh;
        width: 100%;
        display: flex;
        flex-direction: column;
    }

    .hero {
        background-color: #1e293b;
        color: white;
        padding: 60px 20px;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100vw;
        height: 300px; /* Ensure the correct static height */
        box-sizing: border-box;
        position: relative; /* Prevents shifting */
        z-index: 2; /* Ensures it's above other content */
    }

    .hero h1, .hero p {
        max-width: 90%;
        width: auto;
        text-align: center;
        margin: 0 auto; /* Ensures proper centering */
        display: block;
    }

    .hero .subjects {
        text-align: center;
        width: 100%;
        margin-top: 10px;
        font-size: 1rem;
        font-weight: bold;
        color: #ff6f61;
    }

    /* Tutor Cards */
    .container {
        width: 90%;
        max-width: 1200px;
        margin-top: 20px;
    }

    .tutor-card {
        background-color: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s;
        cursor: pointer;
    }

    .tutor-card:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        background-color: #ffeae6; /* Light red highlight */
    }

    .tutor-card.selected {
        background-color: #a6d4fa; /* Softer blue for selected cards */
        color: black;
        border: 2px solid black; /* Slightly darker border for contrast */
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .tutor-info a {
        color: #1e293b; /* Blue from your website */
        text-decoration: none;
        font-weight: bold;
        font-size: 1.1rem;
        transition: font-weight 0.3s, color 0.3s;
    }

    .tutor-card:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        background-color: #dceffd; /* Light blue highlight */
    }
    .tutor-info a:hover {
        text-decoration: underline; /* Add underline on hover */
        color: #ff6f61; /* Change color for hover */
    }

    .tutor-card.selected .tutor-info a:hover {
        color: #f7f7f7; /* Light gray hover for links on selected cards */
        text-decoration: underline;
    }

    .tutor-card img {
        width: 100px; /* Adjusted size for better proportion */
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0; /* Ensures the image doesn't shrink when resizing */
    }

    .tutor-info {
        flex-grow: 1;
        margin-left: 15px;
    }

    .tutor-info h3 {
        margin: 0;
        color: inherit;
    }

    .tutor-info p {
        margin: 5px 0;
        color: inherit;
    }
    .tutor-info p strong {
        /*content: "Subjects:";  Dynamically adds "Subjects:" */
        display: inline-block; /* Badge-like appearance */
        background-color: #1e293b; /* Highlighted background */
        color: white; /* White text for contrast */
        font-size: 0.9rem; /* Slightly smaller than the list */
        font-weight: bold; /* Makes it stand out */
        padding: 3px 8px; /* Adds spacing inside the badge */
        border-radius: 12px; /* Rounded design */
        margin-right: 8px; /* Space between "Subjects:" and the list */
        vertical-align: middle; /* Aligns with the list text */
    }

    .buttons-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 30px auto;
    }

    .error-message {
        color: #ff6f61;
        font-size: 1rem;
        text-align: center;
        margin-top: 10px;
        display: none;
    }
    .widget-wrapper {
        flex-grow: 1; /* Keeps content flowing below without affecting hero */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        min-height: calc(100vh - 400px); /* Adjust for consistent layout */
        width: 100%;
    }

    .content {
        width: auto; /* Allow the widget to size itself */
    }
    .no-results {
        color: #ff6f61;
        font-size: 1.2rem;
        text-align: center;
        margin-top: 20px;
        font-weight: bold;
        display: none;
        width: 100%;
    }
    .buttons-container {
        display: flex;
        justify-content: center;
        gap: 20px;
    }

    /* Add missing subjects message container */
    #missing-subjects-message {
        display: none;
        text-align: center;
        margin: 20px 0;
        padding: 10px;
        border-radius: 8px;
        background-color: #fff;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    </style>
</head>
<body>
    <!-- Background Pattern Div -->
    <div class="background-pattern" id="background-pattern"></div>
    
    <!-- Main content wrapper to ensure minimum height -->
    <div id="main-content">
        <!-- Navbar Placeholder -->
        <div id="navbar-placeholder"></div>

        <!-- JavaScript to Load Navbar -->
        <script src="../Navbar/Navbar.js" defer></script>
        <!-- Hero Section -->
        <div class="hero" >
            <h1>Select a Tutor</h1>
            <p>Based on your selected subjects, here are the best matches for you.</p>
            <div class="subjects" id="selected-subjects"></div>
        </div>
        <div class="progress-steps">
            <div class="step-container">
                <div class="step">1</div>
            </div>
            <div class="step-container">
                <div class="step">2</div>
            </div>
            <div class="step-container">
                <div class="step">3</div>
            </div>
            <div class="step-container">
                <div class="step">4</div>
            </div>
        </div>
        <script src="../Progress/Progress.js"></script>
        <script>
            // Call updateSteps with the current step number
            document.addEventListener("DOMContentLoaded", function() {
                updateSteps(3); // Change 3 to any current step dynamically
            });
            
        </script>

        <div class="widget-wrapper">
            <div class="container">
                <div id="tutor-container"></div>
                <div class="no-results" id="no-results" style="display: none;">No tutors found for your selected subjects.</div>
            </div>

            <!-- Error Message -->
            <div class="error-message" id="error-message">Please select a tutor before proceeding.</div>
            
            <!-- Missing Subjects Message -->
            <div id="missing-subjects-message"></div>

            <!-- Buttons - Updated to use square-button class -->
            <div class="buttons-container">
                <button class="square-button" onclick="redirectToPreviousPage()">Back</button>
                <button class="square-button" onclick="redirectToNext()">Next</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const buttonsContainer = document.querySelector(".buttons-container");
    const tutorContainer = document.getElementById("tutor-container");

    function adjustButtonPosition() {
        const tutorCards = document.querySelectorAll(".tutor-card");
        if (tutorCards.length > 0) {
            const lastTutorCard = tutorCards[tutorCards.length - 1];
            buttonsContainer.style.marginTop = "30px"; // Creates spacing from last card
            buttonsContainer.style.position = "relative"; // Ensures it doesn't overlap
        }
    }

    adjustButtonPosition();
});

        document.addEventListener('DOMContentLoaded', () => {
            const subjectsDisplay = document.getElementById("selected-subjects");
            const selectedSubjects = JSON.parse(localStorage.getItem("selectedSubjects")) || [];
    
            if (selectedSubjects.length > 0) {
                subjectsDisplay.textContent = "Selected Subjects: " + selectedSubjects.join(", ");
            } else {
                subjectsDisplay.textContent = "No subjects selected.";
            }
    
            // Ensure proper alignment by forcing width and display settings
            subjectsDisplay.style.maxWidth = "90%";
            subjectsDisplay.style.textAlign = "center";
            subjectsDisplay.style.display = "block";
        });
    
        // Retrieve student type from localStorage
        const studentType = localStorage.getItem('studentType');
    
        // Adjust progress dots
        document.addEventListener('DOMContentLoaded', () => {
            const progressContainer = document.querySelector('.progress');
    
            if (studentType === 'Returning Student') {
                // Reduce the number of dots to 4 for Returning Students
                progressContainer.innerHTML = `
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot active"></span>
                    <span class="dot"></span>
                `;
            }
        });
    
        const tutors = [
            { name: "Dianne Simental", subjects: ["K-8th Math", "Algebra 1", "Geometry", "Algebra 2", "Pre-Calculus", "Biology", "AP Biology","AP Biology Exam", "Chemistry", "Physics", "Spanish", "K-8th English", "SAT Math Sections", "ACT Math Section", "ACT Science Section", "GED Mathematical Reasoning Section", "GED Science Section" ], image: "https://i.imgur.com/X0kdDss.jpeg" },
            { name: "Zarek Cole", subjects: ["Algebra 1", "Geometry", "Algebra 2", "Pre-Calculus","Statistics","AP Statistics", "Calculus 1 (AB)", "Calculus 2 (BC)","Calculus 3","College Algebra","Differential Equations","Abstract Algebra", "Physics", "AP Physics", "Chemistry", "AP Chemistry", "ACT Math Section", "GED Mathematcal Reasoning Section", "TSI Math"], image: "https://i.imgur.com/5Cuh8SZ.png" },
            { name: "Evan Varan", subjects: ["K-8th Math", "Algebra 1", "Geometry", "Algebra 2", "Pre-Calculus","Statistics", "Calculus 1 (AB)", "Calculus 2 (BC)","College Algebra", "Biology", "Chemistry", "Physics", "AP Physics", "SAT Math Sections", "ACT Math Section", "TSI Math Section", "ACT Science Section", "GED Mathematcal Reasoning Section", "GED Science Section", "Computer Science", "Circuits", "Engineering"], image: "https://i.imgur.com/zPiwhDv.png" },
        ];
    
        const selectedSubjects = JSON.parse(localStorage.getItem("selectedSubjects")) || [];
        const selectedTutor = { name: null }; // Store selected tutor
        const container = document.getElementById("tutor-container");
        const errorMessage = document.getElementById("error-message");
    
        const noResultsMessage = document.getElementById("no-results");
        const nextButton = document.querySelector('.buttons-container .square-button:nth-child(2)'); // Updated selector
        const backButton = document.querySelector('.buttons-container .square-button:nth-child(1)'); // Updated selector
    
        // Filter tutors based on selected subjects
        const matchingTutors = tutors.filter(tutor =>
            selectedSubjects.every(subject => tutor.subjects.includes(subject))
        );
    
        // If no tutors match, show "No tutors found" message and adjust buttons
        if (matchingTutors.length === 0) {
            noResultsMessage.style.display = "block"; // Show error message
            nextButton.style.display = "none"; // Hide "Next" button
            backButton.style.margin = "0 auto"; // Center "Back" button
            backButton.style.display = "block"; // Ensure it's visible
        } else {
            noResultsMessage.style.display = "none"; // Hide error message
            nextButton.style.display = "inline-block"; // Show "Next" button
            backButton.style.margin = ""; // Reset margin
        }
    
        // Function to sort subjects (selected ones first)
        function sortSubjects(tutorSubjects, selectedSubjects) {
            const selectedFirst = tutorSubjects.filter(subject => selectedSubjects.includes(subject));
            const remaining = tutorSubjects.filter(subject => !selectedSubjects.includes(subject));
            return [...selectedFirst, ...remaining];
        }
    
        // Function to display tutors
        function displayTutors() {
            matchingTutors.forEach(tutor => {
                const sortedSubjects = sortSubjects(tutor.subjects, selectedSubjects); // Sort subjects
                const card = document.createElement("div");
                card.classList.add("tutor-card");
                card.innerHTML = `
                    <img src="${tutor.image}" alt="${tutor.name}">
                    <div class="tutor-info">
                        <h3>${tutor.name}</h3>
                        <p><strong>Teaches:</strong> ${sortedSubjects.join(", ")}</p>
                        <a href="../TutorAboutPages/${tutor.name.replace(/\s+/g, "")}.html" target="_blank" style="color: #1e293b;">Read more about me here</a>
                    </div>
                `;
                card.onclick = () => selectTutor(card, tutor.name); // Select the tutor
                container.appendChild(card);
            });
        }
    
        // Only display tutors if there are matches
        if (matchingTutors.length > 0) {
            displayTutors();
        }
    
        // Select a tutor
        function selectTutor(card, name) {
            const tutor = tutors.find(t => t.name === name);
            if (!tutor) return;

            // Determine subjects that the selected tutor does NOT teach
            const missingSubjects = selectedSubjects.filter(subject => !tutor.subjects.includes(subject));

            // If the tutor is already selected, deselect them
            if (card.classList.contains("selected")) {
                card.classList.remove("selected");
                selectedTutor.name = null;

                // Hide "Next" button (same logic as when no tutor is selected)
                nextButton.style.display = "none";
                backButton.style.margin = "0 auto";

                // Hide missing subjects message
                document.getElementById("missing-subjects-message").style.display = "none";

            } else {
                // Deselect any previously selected tutor
                document.querySelectorAll(".tutor-card").forEach(c => c.classList.remove("selected"));

                // Select the clicked tutor
                card.classList.add("selected");
                selectedTutor.name = name;

                // If the tutor does NOT teach all selected subjects, replicate the logic for hiding "Next"
                if (missingSubjects.length > 0) {
                    nextButton.style.display = "none"; // Hide "Next" button
                    backButton.style.margin = "0 auto"; // Center "Back" button

                    // Display missing subjects message
                    document.getElementById("missing-subjects-message").innerHTML =
                        `<p style="color: #ff6f61; font-weight: bold;">
                            The selected tutor does not teach the following subjects: ${missingSubjects.join(", ")}.
                        </p>
                        <button class="square-button" onclick="deselectTutor()">Schedule with a Different Tutor</button>`; // Updated to square-button
                    document.getElementById("missing-subjects-message").style.display = "block";

                } else {
                    // If the tutor teaches all selected subjects, show "Next" button
                    nextButton.style.display = "inline-block";
                    backButton.style.margin = "";
                    document.getElementById("missing-subjects-message").style.display = "none"; // Hide message
                }
            }
        }

        // Function to deselect the tutor when "Schedule with a Different Tutor" is clicked
        function deselectTutor() {
            document.querySelectorAll(".tutor-card").forEach(c => c.classList.remove("selected"));
            selectedTutor.name = null;

            // Reapply the same logic used when no tutor is selected
            nextButton.style.display = "none";
            backButton.style.margin = "0 auto";
            document.getElementById("missing-subjects-message").style.display = "none";
        }
    
        // Redirect to the next page
        function redirectToNext() {
            if (!selectedTutor.name) {
                errorMessage.style.display = "block"; // Show error message if no tutor is selected
                return;
            }
    
            errorMessage.style.display = "none"; // Hide error message if a tutor is selected
    
            localStorage.setItem("selectedTutor", selectedTutor.name); // Store selected tutor
    
            if (studentType === 'Returning Student') {
                window.location.href = "Student-Portal-First-Time.html"; // Redirect returning students
            } else {
                window.location.href = "Account-Creation.html"; // Redirect first-time students
            }
        }
    
        // Redirect to the previous page
        function redirectToPreviousPage() {
            window.location.href = "ScheduleNowSubjects.html";
        }
    </script>
</body>
</html>